---
title: linux远程开发环境配置
date: 2020-12-27 13:09:31
tags: linux,config,profile,bashrc
---

>记录使用vscode连接raspberry遇到的问题和解决方法，本设定只针对raspberry，其他linux系统可能会有不同的文件配置和读取顺序

#### 如何使用vscode连接raspberry
1. 确保连接设备允许SSH
1. 打开vscode的扩展配置，安装扩展Remote Development，此扩展是多个扩展的集合，此次使用主要是里面的Remote-SSH扩展
1. 安装完配置后右侧会出现远程资源管理器图标，进入后可以新建一个远程配置，新建完配置可以更改配置
    ```
    Host pi # 资源名，可任意配置
    HostName 192.168.1.100 # 连接地址
    #Port 22 # 连接端口，默认22
    User pi # 用户名
    ```

#### bash环境配置

bash环境基本由四个文件决定
* /etc/profile 系统整体设定，主要是执行/etc/profile.d/*.sh 下的文件，设定环境变量PATH，一般不需改动，对全体用户有效
* /etc/bash.bashrc bash基础设置，只要进入bash界面都会读取此文件的配置,其他linux系统可能名称为/etc/.bashrc
* ~/.profile 个人环境配置
* ~/.bashrc 个人bash配置

在shell模式下有两种区别，login shell和non-login shell
* login shell：获取时需要完整的登录流程，例如有tty1~tty6登入，需要输入账号和密码。
* non-login shell：无需重复登录操作，例如X window登入后，启动终端，或者vscode remote通过ssh连接后打开终端

在login shell模式下，首先读取的文件是/etc/profile，之后读取顺序为：~/.bash_profile >~/.bash_login > ~/.profile,这三个文件只会读取其中一个，即这三个文件只有一个文件的配置会起作用，在raspberry中只存在~/.profile，所以执行~/.profile。在~/.profile中存在如下语句，这导致之后读取~/.bashrc文件。
```bash
# if running bash
if [ -n "$BASH_VERSION" ]; then
    # include .bashrc if it exists
    if [ -f "$HOME/.bashrc" ]; then
        . "$HOME/.bashrc"
    fi
fi
```
在non-login模式下，并不会读取/etc/profile文件，而是直接读取~/.profile文件，同上，~/.profile会加载~/.bashrc。vscdoe的bash终端属于non-login模式。

**总结：bash环境由读取文件而有所不同，/etc/.bash.bashrc为bash默认配置文件。在login shell模式下读取顺序为/etc/profile->~/.profile->~/.bashrc，在non-login模式下，读取顺序为~/.profile->~/.bashrc**

#### nodejs和yarn安装
1. 首先配置apt源软件，使用aliyun配置，其他源配置可能会缺少nodejs和yarn安装包,更新配置完成后，一般只运行`sudo apt-get update`即可，其他更新时间太久
    ```
    # 备份apt原文件
    sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
    sudo cp /etc/apt/sources.list.d/raspi.list /etc/apt/sources.list.d/raspi.list.bak


    # 修改/etc/apt/sources.list
    deb http://mirrors.aliyun.com/raspbian/raspbian/ stretch main contrib non-free
    deb-src http://mirrors.aliyun.com/raspbian/raspbian/ stretch main contrib non-free


    # 修改/etc/apt/sources.list.d/raspi.list
    deb http://mirrors.aliyun.com/raspbian/raspbian/ buster main ui
    # Uncomment line below then 'apt-get update' to enable 'apt-get source'
    #deb-src http://archive.raspberrypi.org/debian/ stretch main ui


    #更新软件源列表
    sudo apt-get update
    #更新软件版本
    sudo apt-get upgrade
    sudo apt-get dist-upgrade
    #更新系统内核
    sudo rpi-update
    ```
1. 运行`apt-get install nodejs`和`apt-get install yarnpkg
1. 修改yarn配置
```
sudo mkdir /usr/yarn/cache
sudo mkdir /usr/yarn/global
sudo chmod 777 /usr/yarn/cache #确保其他人可以安装和使用yarn
sudo chmod 777 /usr/yarn/global
yarn config set global-folder "/usr/yarn/global"
yarn config set cache-folder "/usr/yarn/cache"

# 你的用户目录找到 .yarnrc 的文件，打开它，找到 viglobal-folder ，改为 --global-folder
# ~/.yarnrc内容

# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1

registry "https://registry.npm.taobao.org"
cache-folder "/usr/yarn/cache"
--global-folder "/usr/yarn/global"
lastUpdateCheck 1608561062226

mkdir ~/.bash_aliases # 新建命令别名文件

# ~/.bash_aliases内容

alias ll='ls -al --color=auto'
alias yarn='yarnpkg'

# 添加yarn全局文件夹到环境变量里，在~/.profile中添加
PATH="/usr/yarn/global/node_modules/.bin:$PATH"

```